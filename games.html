<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Play the Game | TUPE</title>

<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Site-wide CSS -->
<link rel="stylesheet" href="style.css">

<!-- Font Awesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
  body { margin:0; overflow:hidden; background-color:#0d6b63; }
  
  canvas {
    display:block;
    margin:0 auto;
    border:3px solid #0d6b63;
    position: relative;
    z-index: 1;
  }

  #ui {
  position: absolute;
  top: 70px; /* adjust this so it clears the navbar */
  width: 100%;
  display: flex;
  justify-content: space-around;
  align-items: center;
  padding: 0 20px;
  color: white;
  font-size: 22px;
  font-weight: bold;
  z-index: 1000;
  text-shadow: 1px 1px 5px black;
}
  #ui i { margin-right:5px; }

  #popup {
    position:absolute;
    top:50%; left:50%;
    transform:translate(-50%, -50%);
    background-color:rgba(13,107,99,0.95);
    color:white;
    padding:20px 30px;
    border-radius:10px;
    text-align:center;
    display:none;
    font-size:18px;
    z-index:1100;
  }

  #gameOver {
    display:none;
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    background-color:rgba(0,0,0,0.85);
    color:#fff;
    padding:30px 40px;
    border-radius:15px;
    text-align:center;
    z-index:1200;
  }
  #gameOver h1 {
    font-size:48px;
    animation: pulse 1s infinite;
  }
  #gameOver p { font-size:24px; margin:15px 0; }
  @keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
  }

  #touchControls {
    position:absolute;
    bottom:20px;
    left:50%;
    transform:translateX(-50%);
    display:flex;
    gap:20px;
    z-index:1000;
  }
  .touch-btn {
    width:60px;
    height:60px;
    background-color: rgba(255,255,255,0.4);
    border-radius:10px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:30px;
    user-select:none;
  }
  #spacer {
      height: 100px;
  }
</style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark sticky-top" style="background-color:#0d6b63;">
  <div class="container">
    <a class="navbar-brand fw-bold" href="index.html">TUPE</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" 
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="index.html#about">About</a></li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">Resources</a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="resources/articles.html">Articles</a></li>
            <li><a class="dropdown-item" href="resources/hotlines.html">Hotlines</a></li>
          </ul>
        </li>
        <li class="nav-item"><a class="nav-link" href="index.html#involved">Get Involved</a></li>
        <li class="nav-item"><a class="nav-link" href="donate.html">Donate</a></li>
        <li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
        <li class="nav-item"><a class="nav-link active" href="game.html">Play Game</a></li>
      </ul>
    </div>
  </div>
</nav>
<div id="spacer"></div>
<!-- UI -->
<div id="ui">
  <div id="score"><i class="fas fa-star"></i> Score: 0</div>
  <div id="health"><i class="fas fa-heart"></i> Lives: 3</div>
  <div id="level">Level: 1</div>
</div>

<div id="popup"></div>

<div id="gameOver">
  <h1>Game Over!</h1>
  <p id="finalScore">Your Score: 0</p>
  <button id="restartBtn" class="btn btn-success btn-lg">Restart</button>
</div>

<!-- Game Canvas -->
<canvas id="gameCanvas" width="800" height="450"></canvas>

<!-- Touch Controls -->
<div id="touchControls">
  <div class="touch-btn" id="up">↑</div>
  <div class="touch-btn" id="down">↓</div>
  <div class="touch-btn" id="left">←</div>
  <div class="touch-btn" id="right">→</div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

// Player
let player = { x:50, y:canvas.height/2-25, width:50, height:50, speed:6, img:new Image() };
player.img.src = "https://codehs.com/uploads/d34d660a0892aed2561760e252b362f2";

// Game elements
let obstacles=[], items=[], powerUps=[], obstacleTimer=0, itemTimer=0, powerUpTimer=0;
let score=0, health=3, level=1, bgSpeed=2;
let bgX=0;
let bgImg=new Image();
bgImg.src="https://codehs.com/uploads/bf699d551056b073e7e9628365feecf1";

const messages=[
  "Smoking harms nearly every organ in your body.",
  "Vaping may contain harmful chemicals.",
  "Quitting tobacco improves your health instantly!",
  "Healthy choices boost your energy and mood."
];

const collectSound=new Audio("https://freesound.org/data/previews/269/269127_5121236-lq.mp3");
const hitSound=new Audio("https://freesound.org/data/previews/131/131657_2398400-lq.mp3");
const powerSound=new Audio("https://freesound.org/data/previews/331/331912_3248244-lq.mp3");

let keys={};
document.addEventListener("keydown", e=>keys[e.key]=true);
document.addEventListener("keyup", e=>keys[e.key]=false);

["up","down","left","right"].forEach(dir=>{
  document.getElementById(dir).addEventListener("touchstart",()=>keys["Arrow"+dir.charAt(0).toUpperCase()+dir.slice(1)] = true);
  document.getElementById(dir).addEventListener("touchend",()=>keys["Arrow"+dir.charAt(0).toUpperCase()+dir.slice(1)] = false);
});

function showPopup(text){
  const popup=document.getElementById("popup");
  popup.innerText=text;
  popup.style.display="block";
  setTimeout(()=>{popup.style.display="none";},2000);
}

function collision(a,b){
  return a.x < b.x+b.width && a.x+a.width>b.x && a.y<b.y+b.height && a.y+a.height>b.y;
}

let gameRunning = true;

function gameLoop(){ if(gameRunning){ update(); draw(); requestAnimationFrame(gameLoop); } }

function update(){
  if(keys["ArrowUp"] && player.y>0) player.y-=player.speed;
  if(keys["ArrowDown"] && player.y+player.height<canvas.height) player.y+=player.speed;
  if(keys["ArrowLeft"] && player.x>0) player.x-=player.speed;
  if(keys["ArrowRight"] && player.x+player.width<canvas.width) player.x+=player.speed;

  bgX -= bgSpeed;
  if(bgX <= -canvas.width) bgX=0;

  level=Math.floor(score/500)+1;
  document.getElementById("level").innerText="Level: "+level;
  bgSpeed=2+level*0.5;

  obstacleTimer++;
  if(obstacleTimer > 100 - level*5){
    obstacles.push({x:canvas.width,y:Math.random()*(canvas.height-40),width:40,height:40,img:new Image()});
    obstacles[obstacles.length-1].img.src="https://codehs.com/uploads/2a4771eda71ef78218ae08e01b4f4983";
    obstacleTimer=0;
  }

  itemTimer++;
  if(itemTimer>200){
    items.push({x:canvas.width,y:Math.random()*(canvas.height-30),width:30,height:30,img:new Image()});
    items[items.length-1].img.src="https://codehs.com/uploads/b8a17e213447c795b7903423fff025ba";
    itemTimer=0;
  }

  powerUpTimer++;
  if(powerUpTimer>600){
    const type=Math.random()<0.5?"health":"score";
    powerUps.push({x:canvas.width,y:Math.random()*(canvas.height-30),width:30,height:30,img:new Image(),type:type});
    powerUps[powerUps.length-1].img.src= type==="health" ? "https://codehs.com/uploads/6536d36d6accec5870808db5b126ee7d" : "https://codehs.com/uploads/d9d494091cebeff8d419ee9f8e654b67";
    powerUpTimer=0;
  }

  obstacles.forEach((o,i)=>{
    o.x -= 5 + level*0.5;
    if(collision(player,o)){
      obstacles.splice(i,1);
      health--;
      hitSound.play();
      showPopup(messages[Math.floor(Math.random()*messages.length)]);
    }
  });

  items.forEach((item,i)=>{
    item.x -= 4 + level*0.2;
    if(collision(player,item)){
      items.splice(i,1);
      score+=10;
      collectSound.play();
      showPopup("Great! +10 points for healthy choices!");
    }
  });

  powerUps.forEach((p,i)=>{
    p.x -= 4;
    if(collision(player,p)){
      if(p.type==="health"){ health++; showPopup("Extra Life!"); }
      else { score+=50; showPopup("Score Boost! +50 points"); }
      powerSound.play();
      powerUps.splice(i,1);
    }
  });

  document.getElementById("score").innerHTML='<i class="fas fa-star"></i> Score: '+score;
  document.getElementById("health").innerHTML='<i class="fas fa-heart"></i> Lives: '+health;

  if(health <= 0){
    document.getElementById("gameOver").style.display="block";
    document.getElementById("finalScore").innerText="Your Score: "+score;
    gameRunning=false;
  }
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.drawImage(bgImg,bgX,0,canvas.width,canvas.height);
  ctx.drawImage(bgImg,bgX+canvas.width,0,canvas.width,canvas.height);
  ctx.drawImage(player.img,player.x,player.y,player.width,player.height);
  obstacles.forEach(o=>ctx.drawImage(o.img,o.x,o.y,o.width,o.height));
  items.forEach(item=>ctx.drawImage(item.img,item.x,item.y,item.width,item.height));
  powerUps.forEach(p=>ctx.drawImage(p.img,p.x,p.y,p.width,p.height));
}

// Restart button
document.getElementById("restartBtn").addEventListener("click", ()=>{
  score=0; health=3; level=1;
  obstacles=[]; items=[]; powerUps=[];
  player.y=canvas.height/2-25;
  document.getElementById("score").innerHTML='<i class="fas fa-star"></i> Score: 0';
  document.getElementById("health").innerHTML='<i class="fas fa-heart"></i> Lives: 3';
  document.getElementById("level").innerText="Level: 1";
  document.getElementById("gameOver").style.display="none";
  gameRunning=true;
  gameLoop();
});

gameLoop();
</script>
</body>
</html>